# API 接口文档

## 用户认证相关接口

### 1. 发送邮箱验证码

**接口说明：** 用于注册、找回密码等场景发送邮箱验证码

- **请求URL：** `/api/auth/send-email-code`
- **请求方式：** POST
- **请求参数：**

| 参数名 | 类型   | 必选 | 说明     |
|--------|--------|------|----------|
| email  | string | 是   | 邮箱地址 |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "验证码发送成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误（邮箱格式不正确等）   |
| 429    | 请求过于频繁，请稍后再试       |
| 500    | 服务器错误                     |

- **其他说明：**
  - 验证码有效期为10分钟
  - 同一邮箱地址60秒内只能发送一次验证码
  - 验证码为6位数字

### 2. 用户注册

**接口说明：** 新用户注册接口

- **请求URL：** `/api/auth/register`
- **请求方式：** POST
- **请求参数：**

| 参数名     | 类型   | 必选 | 说明          |
|------------|--------|------|---------------|
| email      | string | 是   | 邮箱地址      |
| email_code | string | 是   | 邮箱验证码    |
| password   | string | 是   | 密码          |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "注册成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误或验证码错误           |
| 409    | 邮箱已被注册                   |
| 500    | 服务器错误                     |

- **其他说明：**
  - 密码长度至少6位
  - 邮箱格式必须符合标准邮箱格式
  - 验证码必须是6位数字
  - 验证码有效期为10分钟

### 3. 用户登录

**接口说明：** 用户登录接口

- **请求URL：** `/api/auth/login`
- **请求方式：** POST
- **请求参数：**

| 参数名   | 类型    | 必选 | 说明                |
|----------|---------|------|---------------------|
| email    | string  | 是   | 用户邮箱            |
| password | string  | 是   | 用户密码            |
| remember | boolean | 否   | 是否保持登录状态    |

- **响应参数：**

| 参数名  | 类型   | 说明                                |
|---------|--------|-------------------------------------|
| code    | number | 状态码                              |
| message | string | 提示信息                            |
| data    | object | 返回的数据，包含token和用户基本信息 |

- **data对象结构：**

| 参数名 | 类型   | 说明                 |
|--------|--------|----------------------|
| token  | string | 用户身份令牌         |
| user   | object | 用户基本信息         |

- **user对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| id          | number  | 用户ID            |
| email       | string  | 用户邮箱          |
| nickname    | string  | 用户昵称          |
| avatar      | string  | 用户头像URL       |

- **响应示例：**

```json
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "user": {
            "id": 1,
            "email": "user@example.com",
            "nickname": "示例用户",
            "avatar": "https://example.com/avatars/default.png"
        }
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 账号或密码错误                 |
| 403    | 账号已被禁用                   |
| 500    | 服务器错误                     |

- **其他说明：**
  - token使用JWT格式，需要在后续请求的header中添加：`Authorization: Bearer {token}`
  - remember为true时，token有效期为30天；为false时，token有效期为24小时
  - 前端在登录成功后会将user信息存储在本地，格式为：`uni.setStorageSync('userInfo', res.data.user)`
  - 个人页面初始加载时会优先使用本地存储的用户信息进行显示，然后再通过API获取完整信息

### 4. 重置密码

**接口说明：** 通过邮箱验证码找回密码

- **请求URL：** `/api/auth/reset-password`
- **请求方式：** POST
- **请求参数：**

| 参数名       | 类型   | 必选 | 说明               |
|--------------|--------|------|-------------------|
| email        | string | 是   | 用户邮箱          |
| email_code   | string | 是   | 邮箱验证码        |
| new_password | string | 是   | 新密码            |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "密码重置成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误或验证码错误           |
| 404    | 用户不存在                     |
| 409    | 新密码与原密码相同             |
| 500    | 服务器错误                     |

- **其他说明：**
  - 新密码长度至少6位
  - 系统会验证新密码与原密码是否相同，不允许设置为相同的密码
  - 验证码通过"发送邮箱验证码"接口获取
  - 验证码有效期为10分钟

## 用户资料管理相关接口

### 1. 获取用户个人信息

**接口说明：** 获取当前登录用户的个人资料信息

- **请求URL：** `/api/user/info`
- **请求方式：** GET
- **请求参数：** 无

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |
| data    | object | 用户信息 |

- **data对象结构：**

| 参数名         | 类型   | 说明                  |
|----------------|--------|---------------------|
| id             | number | 用户ID              |
| email          | string | 用户邮箱            |
| nickname       | string | 用户昵称            |
| avatar         | string | 用户头像URL         |
| bio            | string | 个人简介            |
| followCount    | number | 关注数量            |
| fansCount      | number | 粉丝数量            |
| articleCount   | number | 文章数量            |
| createTime     | string | 注册时间            |

- **响应示例：**

```json
{
    "code": 200,
    "message": "操作成功",
    "data": {
        "id": 1,
        "email": "user@example.com",
        "nickname": "示例用户",
        "avatar": "https://example.com/avatars/default.jpg",
        "bio": "这是我的个人简介",
        "followCount": 10,
        "fansCount": 5,
        "articleCount": 8,
        "createTime": "2023-05-01 12:00:00"
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 用于个人主页信息展示
  - 前端"我的"页面会先使用本地存储的基本用户信息（来自登录响应），然后调用此接口获取完整用户信息
  - 若接口调用失败，前端会使用本地存储的信息作为降级处理
  - 注意：后端返回的字段为`fansCount`，前端使用`followerCount`，需要在代码中进行适配

### 2. 更新用户个人资料

**接口说明：** 更新当前登录用户的个人资料

- **请求URL：** `/api/user/profile`
- **请求方式：** PUT
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明       |
|----------|--------|------|------------|
| nickname | string | 否   | 用户昵称   |
| bio      | string | 否   | 个人简介   |

- **响应参数：**

| 参数名  | 类型   | 说明                 |
|---------|--------|----------------------|
| code    | number | 状态码               |
| message | string | 提示信息             |
| data    | object | 更新后的用户信息     |

- **data对象结构：**

| 参数名    | 类型   | 说明             |
|-----------|--------|------------------|
| nickname  | string | 更新后的用户昵称 |
| bio       | string | 更新后的个人简介 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "个人资料更新成功",
    "data": {
        "nickname": "新昵称",
        "bio": "这是更新后的个人简介"
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 可以只更新昵称或者只更新个人简介，不需要同时提供
  - 昵称长度限制：2-20个字符
  - 个人简介长度限制：0-200个字符

### 3. 上传用户头像

**接口说明：** 上传或更新当前登录用户的头像

- **请求URL：** `/api/user/avatar`
- **请求方式：** POST
- **请求类型：** multipart/form-data
- **请求参数：**

| 参数名 | 类型 | 必选 | 说明     |
|--------|------|------|----------|
| avatar | file | 是   | 头像文件 |

- **响应参数：**

| 参数名  | 类型   | 说明             |
|---------|--------|------------------|
| code    | number | 状态码           |
| message | string | 提示信息         |
| data    | object | 上传成功后的信息 |

- **data对象结构：**

| 参数名    | 类型   | 说明                 |
|-----------|--------|----------------------|
| avatarUrl | string | 头像的访问URL        |

- **响应示例：**

```json
{
    "code": 200,
    "message": "头像上传成功",
    "data": {
        "avatarUrl": "https://example.com/avatars/user_1.jpg"
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 文件格式不支持或文件过大       |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 支持的文件格式：jpg、jpeg、png、gif
  - 文件大小限制：2MB
  - 上传成功后会自动裁剪和压缩图片
  - 旧头像会被自动删除

### 4. 获取用户关注列表

**接口说明：** 获取当前登录用户的关注列表

- **请求URL：** `/api/user/follows`
- **请求方式：** GET
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明                              |
|----------|--------|------|-----------------------------------|
| page     | number | 否   | 页码，默认1                       |
| pageSize | number | 否   | 每页条数，默认10，最大50          |
| keyword  | string | 否   | 搜索关键词，用于按昵称搜索关注的用户 |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |
| data    | object | 分页数据     |

- **data对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| total       | number  | 总记录数          |
| pages       | number  | 总页数            |
| list        | array   | 关注用户列表      |

- **list数组元素结构：**

| 参数名        | 类型    | 说明              |
|---------------|---------|------------------|
| id            | number  | 用户ID           |
| nickname      | string  | 用户昵称         |
| avatar        | string  | 用户头像URL      |
| bio           | string  | 用户个人简介     |
| isFollowedByMe | boolean | 当前登录用户是否关注此用户 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 15,
        "pages": 2,
        "list": [
            {
                "id": 2,
                "nickname": "用户昵称",
                "avatar": "user_2_avatar.jpg",
                "bio": "这是个人简介",
                "isFollowedByMe": true
            },
            // 更多用户...
        ]
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 返回的avatar字段可能存在三种形式：
    1. 仅文件名，如：`user_2_avatar.jpg`
    2. 完整相对路径，如：`/uploads/avatars/user_2_avatar.jpg`
    3. 完整URL，如：`http://example.com/uploads/avatars/user_2_avatar.jpg`
  - 前端需要根据不同情况处理头像URL，确保正确显示
  - 支持通过keyword参数搜索用户昵称
  - 可配合关注/取消关注接口实现关注管理

### 5. 关注用户

**接口说明：** 关注指定用户

- **请求URL：** `/api/user/follow/{userId}`
- **请求方式：** POST
- **请求参数：**

| 参数名 | 类型   | 必选 | 说明                    |
|--------|--------|------|------------------------|
| userId | number | 是   | 要关注的用户ID，包含在URL路径中 |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |

- **响应示例：**

```json
{
    "code": 200,
    "message": "关注成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 不能关注自己                   |
| 401    | 未登录或token无效              |
| 404    | 用户不存在                     |
| 409    | 已经关注过该用户               |
| 500    | 服务器错误                     |

### 6. 取消关注用户

**接口说明：** 取消关注指定用户

- **请求URL：** `/api/user/follow/{userId}`
- **请求方式：** DELETE 
- **请求参数：**

| 参数名 | 类型   | 必选 | 说明                    |
|--------|--------|------|------------------------|
| userId | number | 是   | 要取消关注的用户ID，包含在URL路径中 |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |

- **响应示例：**

```json
{
    "code": 200,
    "message": "已取消关注"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 401    | 未登录或token无效              |
| 404    | 用户不存在或未关注该用户       |
| 500    | 服务器错误                     |

### 7. 获取用户粉丝列表

**接口说明：** 获取指定用户的粉丝列表

- **请求URL：** `/api/user/followers/{userId}`
- **请求方式：** GET
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明                              |
|----------|--------|------|-----------------------------------|
| userId   | number | 是   | 用户ID，包含在URL路径中           |
| page     | number | 否   | 页码，默认1                       |
| pageSize | number | 否   | 每页条数，默认10，最大50          |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |
| data    | object | 分页数据     |

- **data对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| total       | number  | 总记录数          |
| pages       | number  | 总页数            |
| currentPage | number  | 当前页码          |
| pageSize    | number  | 每页条数          |
| list        | array   | 粉丝用户列表      |

- **list数组元素结构：**

| 参数名        | 类型    | 说明              |
|---------------|---------|------------------|
| id            | number  | 用户ID           |
| nickname      | string  | 用户昵称         |
| avatar        | string  | 用户头像URL      |
| bio           | string  | 用户个人简介     |
| isFollowing   | boolean | 当前登录用户是否关注此用户 |

### 8. 获取用户资料

**接口说明：** 获取指定用户的详细资料

- **请求URL：** `/api/user/profile/{userId}`
- **请求方式：** GET
- **请求参数：**

| 参数名 | 类型   | 必选 | 说明                    |
|--------|--------|------|------------------------|
| userId | number | 是   | 用户ID，包含在URL路径中 |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |
| data    | object | 用户资料     |

- **data对象结构：**

| 参数名         | 类型    | 说明                          |
|---------------|---------|------------------------------|
| id            | number  | 用户ID                       |
| nickname      | string  | 用户昵称                     |
| avatar        | string  | 用户头像URL                  |
| bio           | string  | 个人简介                     |
| postCount     | number  | 发表的文章数量               |
| followCount   | number  | 关注数量                     |
| followerCount | number  | 粉丝数量                     |

- **响应示例：**

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "nickname": "示例用户",
        "avatar": "/uploads/avatars/user_1_1746006650938.jpg",
        "bio": "这是我的个人简介",
        "postCount": 10,
        "followCount": 20,
        "followerCount": 30
    }
}
```

- **错误码说明：**

| 错误码 | 说明           |
|--------|--------------|
| 200    | 请求成功     |
| 404    | 用户不存在   |
| 500    | 服务器错误   |

- **其他说明：**
  - avatar可能返回完整路径（以/uploads开头）或仅文件名
  - 前端需要处理avatar字段，确保显示完整URL

### 9. 获取用户文章列表

**接口说明：** 获取指定用户发表或点赞的文章列表

- **请求URL：** `/api/user/{userId}/articles`
- **请求方式：** GET
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明                                    |
|----------|--------|------|----------------------------------------|
| userId   | number | 是   | 用户ID，包含在URL路径中                 |
| type     | string | 是   | 文章类型：posts(发表的) / likes(点赞的) |
| page     | number | 否   | 页码，默认1                             |
| pageSize | number | 否   | 每页条数，默认10                        |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |
| data    | object | 分页数据     |

- **data对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| total       | number  | 总记录数          |
| list        | array   | 文章列表          |

- **list数组元素结构：**

| 参数名        | 类型    | 说明              |
|---------------|---------|------------------|
| id            | number  | 文章ID           |
| title         | string  | 文章标题         |
| summary       | string  | 文章摘要         |
| createTime    | string  | 发布时间         |
| viewCount     | number  | 浏览量           |
| likeCount     | number  | 点赞量           |
| commentCount  | number  | 评论量           |

- **响应示例：**

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 20,
        "list": [
            {
                "id": 1,
                "title": "文章标题",
                "summary": "文章摘要...",
                "createTime": "2024-03-20 10:00:00",
                "viewCount": 100,
                "likeCount": 50,
                "commentCount": 30
            }
        ]
    }
}
```

## 功能说明

### 用户资料展示页面

1. 页面功能：
   - 显示用户基本信息（头像、昵称、个人简介）
   - 显示用户统计信息（发表数、关注数、粉丝数）
   - 支持点击头像查看大图
   - 自适应布局，适合各种屏幕尺寸
   - 个人简介区域显示"个人简介："标签，文本自动换行

2. 数据处理：
   - 页面加载时通过 `/api/user/profile/{userId}` 获取用户资料
   - 头像URL处理支持多种格式：
     - 空值返回默认头像
     - http(s)链接直接使用
     - /uploads开头的完整相对路径
     - 仅文件名的情况
   - 统计数据（发表数、关注数、粉丝数）自动显示
   - 后端返回的 `followerCount` 用于显示粉丝数

3. 样式说明：
   - 个人简介区域宽度自适应（最大宽度100%）
   - 添加了合适的行高（line-height: 1.4）
   - 支持长文本自动换行（word-wrap: break-word）
   - 兼容APP、微信小程序和H5三个平台

4. 实现细节：
   - 使用 box-sizing: border-box 确保跨平台一致性
   - 使用 flex 布局实现自适应效果
   - 头像使用 flex-shrink: 0 防止缩小
   - 使用条件编译确保在不同平台显示一致

### 关注列表页面

1. 页面功能：
   - 显示当前用户的关注列表
   - 支持搜索关注的用户（按昵称）
   - 支持下拉刷新和上拉加载更多
   - 可关注/取消关注列表中的用户
   - 点击用户可跳转到其个人资料页

2. 数据处理：
   - 通过 `/api/user/follows` 接口获取关注列表
   - 支持分页加载（pageSize默认10）
   - 关注/取消关注功能通过 `/api/user/follow/{userId}` 接口实现
   - 取消关注时会显示确认对话框
   - 头像URL处理支持三种格式：
     - 空值返回默认头像 `/static/images/avatar.png`
     - http(s)链接直接使用
     - /uploads开头的完整相对路径，拼接baseURL
     - 仅文件名的情况，拼接完整路径`${baseURL}/uploads/avatars/${avatar}`

3. 样式说明：
   - 列表项高度固定为160rpx，确保一致的视觉效果
   - 个人简介文本超出显示省略号（单行显示）
   - 个人简介最大宽度为420rpx
   - 按钮使用flex-shrink: 0确保不被挤压

4. 交互优化：
   - 关注/取消关注按钮添加loading状态
   - 操作成功和失败都有明确的Toast提示
   - 搜索、刷新、加载更多功能无缝配合
   - 无关注用户时显示空状态提示并提供"去发现更多"按钮
   - 下拉刷新时确保刷新区域背景色与页面背景一致
   - 在H5环境下支持新窗口打开用户资料页