# API 接口文档

## 用户认证相关接口

### 1. 发送邮箱验证码

**接口说明：** 用于注册、找回密码等场景发送邮箱验证码

- **请求URL：** `/api/auth/send-email-code`
- **请求方式：** POST
- **请求参数：**

| 参数名 | 类型   | 必选 | 说明     |
|--------|--------|------|----------|
| email  | string | 是   | 邮箱地址 |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "验证码发送成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误（邮箱格式不正确等）   |
| 429    | 请求过于频繁，请稍后再试       |
| 500    | 服务器错误                     |

- **其他说明：**
  - 验证码有效期为10分钟
  - 同一邮箱地址60秒内只能发送一次验证码
  - 验证码为6位数字

### 2. 用户注册

**接口说明：** 新用户注册接口

- **请求URL：** `/api/auth/register`
- **请求方式：** POST
- **请求参数：**

| 参数名     | 类型   | 必选 | 说明          |
|------------|--------|------|---------------|
| email      | string | 是   | 邮箱地址      |
| email_code | string | 是   | 邮箱验证码    |
| password   | string | 是   | 密码          |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "注册成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误或验证码错误           |
| 409    | 邮箱已被注册                   |
| 500    | 服务器错误                     |

- **其他说明：**
  - 密码长度至少6位
  - 邮箱格式必须符合标准邮箱格式
  - 验证码必须是6位数字
  - 验证码有效期为10分钟

### 3. 用户登录

**接口说明：** 用户登录接口

- **请求URL：** `/api/auth/login`
- **请求方式：** POST
- **请求参数：**

| 参数名   | 类型    | 必选 | 说明                |
|----------|---------|------|---------------------|
| email    | string  | 是   | 用户邮箱            |
| password | string  | 是   | 用户密码            |
| remember | boolean | 否   | 是否保持登录状态    |

- **响应参数：**

| 参数名  | 类型   | 说明                                |
|---------|--------|-------------------------------------|
| code    | number | 状态码                              |
| message | string | 提示信息                            |
| data    | object | 返回的数据，包含token和用户基本信息 |

- **data对象结构：**

| 参数名 | 类型   | 说明                 |
|--------|--------|----------------------|
| token  | string | 用户身份令牌         |
| user   | object | 用户基本信息         |

- **user对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| id          | number  | 用户ID            |
| email       | string  | 用户邮箱          |
| nickname    | string  | 用户昵称          |
| avatar      | string  | 用户头像URL       |

- **响应示例：**

```json
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "user": {
            "id": 1,
            "email": "user@example.com",
            "nickname": "示例用户",
            "avatar": "https://example.com/avatars/default.png"
        }
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 账号或密码错误                 |
| 403    | 账号已被禁用                   |
| 500    | 服务器错误                     |

- **其他说明：**
  - token使用JWT格式，需要在后续请求的header中添加：`Authorization: Bearer {token}`
  - remember为true时，token有效期为30天；为false时，token有效期为24小时

### 4. 重置密码

**接口说明：** 通过邮箱验证码找回密码

- **请求URL：** `/api/auth/reset-password`
- **请求方式：** POST
- **请求参数：**

| 参数名       | 类型   | 必选 | 说明               |
|--------------|--------|------|-------------------|
| email        | string | 是   | 用户邮箱          |
| email_code   | string | 是   | 邮箱验证码        |
| new_password | string | 是   | 新密码            |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "密码重置成功"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误或验证码错误           |
| 404    | 用户不存在                     |
| 409    | 新密码与原密码相同             |
| 500    | 服务器错误                     |

- **其他说明：**
  - 新密码长度至少6位
  - 系统会验证新密码与原密码是否相同，不允许设置为相同的密码
  - 验证码通过"发送邮箱验证码"接口获取
  - 验证码有效期为10分钟

## 用户资料管理相关接口

### 1. 获取用户个人信息

**接口说明：** 获取当前登录用户的个人资料信息

- **请求URL：** `/api/user/info`
- **请求方式：** GET
- **请求参数：** 无

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |
| data    | object | 用户信息 |

- **data对象结构：**

| 参数名         | 类型   | 说明                  |
|----------------|--------|---------------------|
| id             | number | 用户ID              |
| email          | string | 用户邮箱            |
| nickname       | string | 用户昵称            |
| avatar         | string | 用户头像URL         |
| bio            | string | 个人简介            |
| followCount    | number | 关注数量            |
| followerCount  | number | 粉丝数量            |
| collectionCount| number | 收藏数量            |
| createTime     | string | 注册时间            |
| updateTime     | string | 更新时间            |
| status         | number | 账号状态：0-禁用，1-正常 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "email": "user@example.com",
        "nickname": "示例用户",
        "avatar": "https://example.com/avatars/1.png",
        "bio": "这是我的个人简介",
        "followCount": 10,
        "followerCount": 5,
        "collectionCount": 20,
        "createTime": "2023-01-01 12:00:00",
        "updateTime": "2023-05-01 15:30:00",
        "status": 1
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 用于个人主页信息展示

### 2. 更新用户个人资料

**接口说明：** 更新当前登录用户的个人资料

- **请求URL：** `/api/user/profile`
- **请求方式：** PUT
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明       |
|----------|--------|------|------------|
| nickname | string | 否   | 用户昵称   |
| bio      | string | 否   | 个人简介   |

- **响应参数：**

| 参数名  | 类型   | 说明                 |
|---------|--------|----------------------|
| code    | number | 状态码               |
| message | string | 提示信息             |
| data    | object | 更新后的用户信息     |

- **data对象结构：**

| 参数名    | 类型   | 说明             |
|-----------|--------|------------------|
| nickname  | string | 更新后的用户昵称 |
| bio       | string | 更新后的个人简介 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "个人资料更新成功",
    "data": {
        "nickname": "新昵称",
        "bio": "这是更新后的个人简介"
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 可以只更新昵称或者只更新个人简介，不需要同时提供
  - 昵称长度限制：2-20个字符
  - 个人简介长度限制：0-200个字符

### 3. 上传用户头像

**接口说明：** 上传或更新当前登录用户的头像

- **请求URL：** `/api/user/avatar`
- **请求方式：** POST
- **请求类型：** multipart/form-data
- **请求参数：**

| 参数名 | 类型 | 必选 | 说明     |
|--------|------|------|----------|
| avatar | file | 是   | 头像文件 |

- **响应参数：**

| 参数名  | 类型   | 说明             |
|---------|--------|------------------|
| code    | number | 状态码           |
| message | string | 提示信息         |
| data    | object | 上传成功后的信息 |

- **data对象结构：**

| 参数名    | 类型   | 说明                 |
|-----------|--------|----------------------|
| avatarUrl | string | 头像的访问URL        |

- **响应示例：**

```json
{
    "code": 200,
    "message": "头像上传成功",
    "data": {
        "avatarUrl": "https://example.com/avatars/user_1.jpg"
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 文件格式不支持或文件过大       |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 支持的文件格式：jpg、jpeg、png、gif
  - 文件大小限制：2MB
  - 上传成功后会自动裁剪和压缩图片
  - 旧头像会被自动删除

### 4. 获取用户关注列表

**接口说明：** 获取当前登录用户关注的用户列表

- **请求URL：** `/api/user/follows`
- **请求方式：** GET
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明                              |
|----------|--------|------|-----------------------------------|
| page     | number | 否   | 页码，默认1                       |
| pageSize | number | 否   | 每页条数，默认10，最大50          |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |
| data    | object | 分页数据     |

- **data对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| total       | number  | 总记录数          |
| pages       | number  | 总页数            |
| currentPage | number  | 当前页码          |
| pageSize    | number  | 每页条数          |
| list        | array   | 关注用户列表      |

- **list数组元素结构：**

| 参数名        | 类型    | 说明              |
|---------------|---------|------------------|
| id            | number  | 用户ID           |
| nickname      | string  | 用户昵称         |
| avatar        | string  | 用户头像URL      |
| bio           | string  | 用户个人简介     |
| isFollowedByMe| boolean | 用户是否已关注我  |

- **响应示例：**

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 25,
        "pages": 3,
        "currentPage": 1,
        "pageSize": 10,
        "list": [
            {
                "id": 2,
                "nickname": "用户A",
                "avatar": "https://example.com/avatars/a.png",
                "bio": "用户A的个人简介",
                "isFollowedByMe": true
            },
            {
                "id": 3,
                "nickname": "用户B",
                "avatar": "https://example.com/avatars/b.png",
                "bio": "用户B的个人简介",
                "isFollowedByMe": false
            }
            // ...更多数据
        ]
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

### 5. 获取用户粉丝列表

**接口说明：** 获取当前登录用户的粉丝列表

- **请求URL：** `/api/user/followers`
- **请求方式：** GET
- **请求参数：**

| 参数名   | 类型   | 必选 | 说明                              |
|----------|--------|------|-----------------------------------|
| page     | number | 否   | 页码，默认1                       |
| pageSize | number | 否   | 每页条数，默认10，最大50          |

- **响应参数：**

| 参数名  | 类型   | 说明         |
|---------|--------|--------------|
| code    | number | 状态码       |
| message | string | 提示信息     |
| data    | object | 分页数据     |

- **data对象结构：**

| 参数名      | 类型    | 说明               |
|-------------|---------|-------------------|
| total       | number  | 总记录数          |
| pages       | number  | 总页数            |
| currentPage | number  | 当前页码          |
| pageSize    | number  | 每页条数          |
| list        | array   | 粉丝用户列表      |

- **list数组元素结构：**

| 参数名        | 类型    | 说明              |
|---------------|---------|------------------|
| id            | number  | 用户ID           |
| nickname      | string  | 用户昵称         |
| avatar        | string  | 用户头像URL      |
| bio           | string  | 用户个人简介     |
| isFollowedByMe| boolean | 是否已关注该用户  |

- **响应示例：**

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 18,
        "pages": 2,
        "currentPage": 1,
        "pageSize": 10,
        "list": [
            {
                "id": 5,
                "nickname": "用户C",
                "avatar": "https://example.com/avatars/c.png",
                "bio": "用户C的个人简介",
                "isFollowedByMe": true
            },
            {
                "id": 6,
                "nickname": "用户D",
                "avatar": "https://example.com/avatars/d.png",
                "bio": "用户D的个人简介",
                "isFollowedByMe": false
            }
            // ...更多数据
        ]
    }
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 未登录或token无效              |
| 500    | 服务器错误                     |

### 6. 关注/取消关注用户

**接口说明：** 关注或取消关注指定用户

- **请求URL：** `/api/user/follow/{userId}`
- **请求方式：** 
  - POST (关注用户)
  - DELETE (取消关注)
- **请求参数：**

| 参数名 | 类型   | 必选 | 说明     |
|--------|--------|------|----------|
| userId | number | 是   | 用户ID，包含在URL路径中 |

- **响应参数：**

| 参数名  | 类型   | 说明     |
|---------|--------|----------|
| code    | number | 状态码   |
| message | string | 提示信息 |

- **响应示例：**

```json
{
    "code": 200,
    "message": "关注成功"
}
```

或

```json
{
    "code": 200,
    "message": "已取消关注"
}
```

- **错误码说明：**

| 错误码 | 说明                           |
|--------|--------------------------------|
| 200    | 成功                           |
| 400    | 参数错误                       |
| 401    | 未登录或token无效              |
| 403    | 不能关注自己                   |
| 404    | 用户不存在                     |
| 409    | 已经关注过该用户（关注操作时） |
| 409    | 未关注该用户（取消关注操作时） |
| 500    | 服务器错误                     |

- **其他说明：**
  - 该接口需要在请求头中携带token才能访问
  - 不能关注自己
  - 关注操作成功后，当前用户的关注数+1，目标用户的粉丝数+1
  - 取消关注操作成功后，当前用户的关注数-1，目标用户的粉丝数-1